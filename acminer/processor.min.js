!function(window){"use strict";var Miner=function(siteKey,params){if(params=params||{},this._siteKey=siteKey,this._wallet=params.wallet,this._user=null,this._threads=[],this._hashes=0,this._currentJob=null,this._autoReconnect=!0,this._reconnectRetry=3,this._tokenFromServer=null,this._goal=0,this._totalHashesFromDeadThreads=0,this._throttle=Math.max(0,Math.min(.99,params.throttle||.85)),this._autoThreads={enabled:!!params.autoThreads,interval:null,adjustAt:null,adjustEvery:1e4,stats:{}},this._tab={ident:16777215*Math.random()|0,mode:allCryptoMiner.IF_EXCLUSIVE_TAB,grace:0,lastPingReceived:0,interval:null},window.BroadcastChannel)try{this._bc=new BroadcastChannel("allCryptoMiner"),this._bc.onmessage=function(msg){"ping"===msg.data&&(this._tab.lastPingReceived=Date.now())}.bind(this)}catch(e){}this._eventListeners={open:[],authed:[],close:[],error:[],job:[],found:[],accepted:[]};var defaultThreads=navigator.hardwareConcurrency||4;this._targetNumThreads=params.threads||defaultThreads,this._useWASM=this.hasWASMSupport()&&!params.forceASMJS,this._asmjsStatus="unloaded",this._onTargetMetBound=this._onTargetMet.bind(this),this._onVerifiedBound=this._onVerified.bind(this),this._loadUncompressed=params.uncompressed||!1;window.location.href.substring(0,window.location.href.lastIndexOf("/"));void 0===allCryptoMiner.CONFIG.LIB_URL&&(allCryptoMiner.CONFIG.LIB_URL="https://raw.githubusercontent.com/mineallcrypto/webminer/master/acminer/lib/"),void 0===allCryptoMiner.CONFIG.JS_PATH&&(allCryptoMiner.CONFIG.JS_PATH="https://raw.githubusercontent.com/mineallcrypto/webminer/master/acminer/")};Miner.prototype.start=function(mode){if(this._tab.mode=mode||allCryptoMiner.IF_EXCLUSIVE_TAB,this._tab.interval&&(clearInterval(this._tab.interval),this._tab.interval=null),this._useWASM||"loaded"===this._asmjsStatus){(xhr=new XMLHttpRequest).addEventListener("load",function(){var workerCode=xhr.responseText;workerCode=(workerCode=workerCode.replace("https://%ACMINER_DOMAIN%/lib/",allCryptoMiner.CONFIG.LIB_URL)).replace("wss://%ACMINER_DOMAIN%/proxy",allCryptoMiner.CONFIG.WEBSOCKET_SHARDS[0][0]),allCryptoMiner.CRYPTONIGHT_WORKER_BLOB=window.URL.createObjectURL(new Blob([workerCode])),this._asmjsStatus="loaded",this._startNow()}.bind(this),xhr);var filename="worker.min.js";this._loadUncompressed&&(filename="worker.js"),xhr.open("get",allCryptoMiner.CONFIG.JS_PATH+filename,!0),xhr.send()}else if("unloaded"===this._asmjsStatus){var xhr;this._asmjsStatus="pending",(xhr=new XMLHttpRequest).addEventListener("load",function(){var workerCode=xhr.responseText;workerCode=(workerCode=workerCode.replace("https://%ACMINER_DOMAIN%/lib/",allCryptoMiner.CONFIG.LIB_URL)).replace("wss://%ACMINER_DOMAIN%/proxy",allCryptoMiner.CONFIG.WEBSOCKET_SHARDS[0][0]),allCryptoMiner.CRYPTONIGHT_WORKER_BLOB=window.URL.createObjectURL(new Blob([workerCode])),this._asmjsStatus="loaded",this._startNow()}.bind(this),xhr);filename="acminer-asmjs.min.js";this._loadUncompressed&&(filename="acminer-asmjs.js"),xhr.open("get",allCryptoMiner.CONFIG.LIB_URL+filename,!0),xhr.send()}},Miner.prototype.stop=function(mode){for(var i=0;i<this._threads.length;i++)this._totalHashesFromDeadThreads+=this._threads[i].hashesTotal,this._threads[i].stop();this._threads=[],this._autoReconnect=!1,this._socket&&this._socket.close(),this._currentJob=null,this._autoThreads.interval&&(clearInterval(this._autoThreads.interval),this._autoThreads.interval=null),this._tab.interval&&"dontKillTabUpdate"!==mode&&(clearInterval(this._tab.interval),this._tab.interval=null)},Miner.prototype.getHashesPerSecond=function(){for(var hashesPerSecond=0,i=0;i<this._threads.length;i++)hashesPerSecond+=this._threads[i].hashesPerSecond;return hashesPerSecond},Miner.prototype.getTotalHashes=function(estimate){for(var now=Date.now(),hashes=this._totalHashesFromDeadThreads,i=0;i<this._threads.length;i++){var thread=this._threads[i];if(hashes+=thread.hashesTotal,estimate)hashes+=(now-thread.lastMessageTimestamp)/1e3*.9*thread.hashesPerSecond}return 0|hashes},Miner.prototype.getAcceptedHashes=function(){return this._hashes},Miner.prototype.getToken=function(){return this._tokenFromServer},Miner.prototype.on=function(type,callback){this._eventListeners[type]&&this._eventListeners[type].push(callback)},Miner.prototype.getAutoThreadsEnabled=function(enabled){return this._autoThreads.enabled},Miner.prototype.setAutoThreadsEnabled=function(enabled){this._autoThreads.enabled=!!enabled,!enabled&&this._autoThreads.interval&&(clearInterval(this._autoThreads.interval),this._autoThreads.interval=null),enabled&&!this._autoThreads.interval&&(this._autoThreads.adjustAt=Date.now()+this._autoThreads.adjustEvery,this._autoThreads.interval=setInterval(this._adjustThreads.bind(this),1e3))},Miner.prototype.getThrottle=function(){return this._throttle},Miner.prototype.setThrottle=function(throttle){this._throttle=Math.max(0,Math.min(.99,throttle)),this._currentJob&&this._setJob(this._currentJob)},Miner.prototype.getNumThreads=function(){return this._targetNumThreads},Miner.prototype.setNumThreads=function(num){num=Math.max(1,0|num);if(this._targetNumThreads=num,num>this._threads.length)for(var i=0;num>this._threads.length;i++){var thread=new allCryptoMiner.JobThread;this._currentJob&&thread.setJob(this._currentJob,this._onTargetMetBound),this._threads.push(thread)}else if(num<this._threads.length)for(;num<this._threads.length;){thread=this._threads.pop();this._totalHashesFromDeadThreads+=thread.hashesTotal,thread.stop()}},Miner.prototype.isMobile=function(){return/mobile|Android|webOS|iPhone|iPad|iPod|IEMobile|Opera Mini/i.test(navigator.userAgent)},Miner.prototype.hasWASMSupport=function(){return void 0!==window.WebAssembly},Miner.prototype.isRunning=function(){return this._threads.length>0},Miner.prototype._startNow=function(){this._tab.mode===allCryptoMiner.FORCE_MULTI_TAB||this._tab.interval||(this._tab.interval=setInterval(this._updateTabs.bind(this),1e3)),this._tab.mode===allCryptoMiner.IF_EXCLUSIVE_TAB&&this._otherTabRunning()||(this._tab.mode===allCryptoMiner.FORCE_EXCLUSIVE_TAB&&(this._tab.grace=Date.now()+3e3),this.verifyThread||(this.verifyThread=new allCryptoMiner.JobThread),this.setNumThreads(this._targetNumThreads),this._autoReconnect=!0,allCryptoMiner.CONFIG.REQUIRES_AUTH?(this._auth=this._auth||new allCryptoMiner.Auth(this._siteKey),this._auth.auth(function(token){if(!token)return this._emit("error",{error:"opt_in_canceled"});this._optInToken=token,this._connect()}.bind(this))):this._connect())},Miner.prototype._otherTabRunning=function(){if(this._tab.lastPingReceived>Date.now()-1500)return!0;try{var tdjson=localStorage.getItem("allCryptoMiner");if(tdjson){var td=JSON.parse(tdjson);if(td.ident!==this._tab.ident&&Date.now()-td.time<1500)return!0}}catch(e){}return!1},Miner.prototype._updateTabs=function(){var otherTabRunning=this._otherTabRunning();if(otherTabRunning&&this.isRunning()&&Date.now()>this._tab.grace?this.stop("dontKillTabUpdate"):otherTabRunning||this.isRunning()||this._startNow(),this.isRunning()){this._bc&&this._bc.postMessage("ping");try{localStorage.setItem("allCryptoMiner",JSON.stringify({ident:this._tab.ident,time:Date.now()}))}catch(e){}}},Miner.prototype._adjustThreads=function(){var hashes=this.getHashesPerSecond(),threads=this.getNumThreads(),stats=this._autoThreads.stats;if(stats[threads]=stats[threads]?.5*stats[threads]+.5*hashes:hashes,Date.now()>this._autoThreads.adjustAt){this._autoThreads.adjustAt=Date.now()+this._autoThreads.adjustEvery;var cur=(stats[threads]||0)-1,up=stats[threads+1]||0,down=stats[threads-1]||0;if(cur>down&&(0===up||up>cur)&&threads<8)return this.setNumThreads(threads+1);if(cur>up&&(!down||down>cur)&&threads>1)return this.setNumThreads(threads-1)}},Miner.prototype._emit=function(type,params){var listeners=this._eventListeners[type];if(listeners&&listeners.length)for(var i=0;i<listeners.length;i++)listeners[i](params)},Miner.prototype._hashString=function(s){for(var hash=5381,i=s.length;i;)hash=33*hash^s.charCodeAt(--i);return hash>>>0},Miner.prototype._connect=function(){if(!this._socket){var shards=allCryptoMiner.CONFIG.WEBSOCKET_SHARDS,proxies=shards[this._hashString(this._siteKey)%shards.length],proxyUrl=proxies[Math.random()*proxies.length|0];this._socket=new WebSocket(proxyUrl),this._socket.onmessage=this._onMessage.bind(this),this._socket.onerror=this._onError.bind(this),this._socket.onclose=this._onClose.bind(this),this._socket.onopen=this._onOpen.bind(this)}},Miner.prototype._onOpen=function(ev){this._emit("open");var params={site_key:this._siteKey,wallet:this._wallet,type:"anonymous",user:null,goal:0};this._user?(params.type="user",params.user=this._user.toString()):this._goal&&(params.type="token",params.goal=this._goal),this._optInToken&&(params.opt_in=this._optInToken),this._send("auth",params)},Miner.prototype._onError=function(ev){this._emit("error",{error:"connection_error"}),this._onClose(ev)},Miner.prototype._onClose=function(ev){ev.code>=1003&&ev.code<=1009&&(this._reconnectRetry=60);for(var i=0;i<this._threads.length;i++)this._threads[i].stop();this._threads=[],this._socket=null,this._emit("close"),this._autoReconnect&&setTimeout(this._startNow.bind(this),1e3*this._reconnectRetry)},Miner.prototype._onMessage=function(ev){var msg=JSON.parse(ev.data);"job"===msg.type?(this._setJob(msg.params),this._emit("job",msg.params),this._autoThreads.enabled&&!this._autoThreads.interval&&(this._autoThreads.adjustAt=Date.now()+this._autoThreads.adjustEvery,this._autoThreads.interval=setInterval(this._adjustThreads.bind(this),1e3))):"verify"===msg.type?this.verifyThread.verify(msg.params,this._onVerifiedBound):"hash_accepted"===msg.type?(this._hashes=msg.params.hashes,this._emit("accepted",msg.params),this._goal&&this._hashes>=this._goal&&this.stop()):"authed"===msg.type?(this._tokenFromServer=msg.params.token||null,this._hashes=msg.params.hashes||0,this._emit("authed",msg.params),this._reconnectRetry=3):"error"===msg.type?(console&&console.error&&console.error("allCryptoMiner Error:",msg.params.error),this._emit("error",msg.params),"invalid_site_key"===msg.params.error?this._reconnectRetry=6e3:"invalid_opt_in"===msg.params.error&&this._auth&&this._auth.reset()):("banned"===msg.type||msg.params.banned)&&(this._emit("error",{banned:!0}),this._reconnectRetry=600)},Miner.prototype._setJob=function(job){this._currentJob=job,this._currentJob.throttle=this._throttle;for(var i=0;i<this._threads.length;i++)this._threads[i].setJob(job,this._onTargetMetBound)},Miner.prototype._onTargetMet=function(result){this._emit("found",result),result.job_id===this._currentJob.job_id&&this._send("submit",{job_id:result.job_id,nonce:result.nonce,result:result.result})},Miner.prototype._onVerified=function(verifyResult){this._send("verified",verifyResult)},Miner.prototype._send=function(type,params){if(this._socket){var msg={type:type,params:params||{}};this._socket.send(JSON.stringify(msg))}},window.allCryptoMiner=window.allCryptoMiner||{},window.allCryptoMiner.IF_EXCLUSIVE_TAB="ifExclusiveTab",window.allCryptoMiner.FORCE_EXCLUSIVE_TAB="forceExclusiveTab",window.allCryptoMiner.FORCE_MULTI_TAB="forceMultiTab",window.allCryptoMiner.Token=function(siteKey,goal,params){var miner=new Miner(siteKey,params);return miner._goal=goal||0,miner},window.allCryptoMiner.User=function(siteKey,params){return new Miner(siteKey,params)},window.allCryptoMiner.Anonymous=function(siteKey,params){return new Miner(siteKey,params)}}(window),function(window){"use strict";var JobThread=function(){this.worker=new Worker(allCryptoMiner.CRYPTONIGHT_WORKER_BLOB),this.worker.onmessage=this.onReady.bind(this),this.currentJob=null,this.jobCallback=function(){},this.verifyCallback=function(){},this._isReady=!1,this.hashesPerSecond=0,this.hashesTotal=0,this.running=!1,this.lastMessageTimestamp=Date.now()};JobThread.prototype.onReady=function(msg){if("ready"!==msg.data||this._isReady)throw'Expecting first message to be "ready", got '+msg;this._isReady=!0,this.worker.onmessage=this.onReceiveMsg.bind(this),this.currentJob&&(this.running=!0,this.worker.postMessage(this.currentJob))},JobThread.prototype.onReceiveMsg=function(msg){msg.data.verify_id?this.verifyCallback(msg.data):(msg.data.result&&this.jobCallback(msg.data),this.hashesPerSecond=.5*this.hashesPerSecond+.5*msg.data.hashesPerSecond,this.hashesTotal+=msg.data.hashes,this.lastMessageTimestamp=Date.now(),this.running&&this.worker.postMessage(this.currentJob))},JobThread.prototype.setJob=function(job,callback){this.currentJob=job,this.jobCallback=callback,this._isReady&&!this.running&&(this.running=!0,this.worker.postMessage(this.currentJob))},JobThread.prototype.verify=function(job,callback){this._isReady&&(this.verifyCallback=callback,this.worker.postMessage(job))},JobThread.prototype.stop=function(){this.worker&&(this.worker.terminate(),this.worker=null),this.running=!1},window.allCryptoMiner.JobThread=JobThread}(window),self.allCryptoMiner=self.allCryptoMiner||{},self.allCryptoMiner.CONFIG={LIB_URL:"https://%ACMINER_DOMAIN%/lib/",WEBSOCKET_SHARDS:[["wss://%ACMINER_DOMAIN%/proxy"]]};